# FFmpeg多功能批处理工具

这是一个基于Java的FFmpeg批处理工具，提供了一个图形界面，用于处理视频文件的批量压缩、去水印等操作。

## 功能特点

- 支持三种处理模式：视频压缩、去除小字幕水印、去除视频末尾的"未完待续"水印
- 批量处理文件夹中的所有媒体文件
- 每种功能模式都可以自定义压缩参数
- 实时显示处理进度和FFmpeg输出日志
- 支持多种视频格式，包括MP4、AVI、MKV、MOV等

## 系统要求

- Java 21或更高版本
- FFmpeg已安装并添加到系统PATH

## 使用说明

### 启动程序

1. 双击运行start.vbs脚本启动程序
2. 或者直接运行命令：`java -jar FFmpegBatchProcessor.jar`

### 基本操作

1. 选择要处理的功能（转小、去小字、去未完待续）
2. 点击"浏览..."按钮选择包含媒体文件的文件夹
3. 根据选择的功能，设置相应的参数
4. 点击"开始处理"按钮开始处理

### 转小（视频压缩）

此功能用于压缩视频文件。

- 输入自定义的FFmpeg压缩参数（默认为高质量压缩）
- 处理后的文件会在原文件名后添加"_c"后缀

### 去小字（去除字幕水印）

此功能用于去除视频中的字幕或小型水印。

- 输入压缩参数：可自定义FFmpeg压缩参数，默认与"转小"模式相同
- 输入去小字参数：使用x,y,w,h格式指定要去除的区域坐标和尺寸（例如：98,1169,879,155）
- 注意：涂抹边界不要紧贴视频边界，留出一定间距效果更好
- 处理后的文件会在原文件名后添加"_s"后缀

### 去未完待续（去除片尾水印）

此功能用于去除视频末尾的"未完待续"等水印。

- 输入压缩参数：可自定义FFmpeg压缩参数，默认与"转小"模式相同
- 输入去未完待续参数：使用x,y,w,h格式指定要去除的区域坐标和尺寸
- 输入结尾处理时长：指定视频末尾需要处理的秒数（默认为2.2秒）
- 处理后的文件会在原文件名后添加"_w"后缀

## 技术特点

本程序利用Java 21的多项新特性，提高了代码质量和执行效率：

### 记录类型（Record Types）
- 使用`record DelogoParams(int x, int y, int width, int height)`创建不可变的数据容器，用于存储和处理坐标参数
- 记录类型自动提供构造器、访问器方法（x()、y()等）和标准方法（equals、hashCode、toString）
- 与传统POJO相比，代码更简洁、更安全，并减少了样板代码

### 文本块（Text Blocks）
- 使用三引号（`"""..."""`）创建多行字符串，用于构建FFmpeg命令
- 文本块保持了字符串的格式和缩进，使复杂的命令结构更清晰
- 结合字符串格式化（`String.formatted`）动态生成命令参数

### 方法引用和Lambda表达式
- 使用方法引用（`this::updateLogFromQueue`）替代传统的匿名内部类
- 通过Lambda表达式（`e -> updateCurrentPage(pageType)`）简化事件处理逻辑
- 利用函数式编程特性使代码更简洁、更易于理解

### 模式匹配和Switch表达式
- 使用增强的switch表达式处理不同页面类型（`switch (currentPage) { case COMPRESS -> ... }`）
- 通过箭头语法（Arrow Syntax）简化分支处理逻辑
- 减少了冗余的break语句和模板代码

### 增强的集合API和Stream操作
- 使用集合工厂方法和Stream API进行数据处理和转换
- 通过链式操作提高了代码可读性和处理效率

### 并发处理优化
- 利用`ConcurrentLinkedQueue`实现线程安全的日志消息队列
- 通过`SwingUtilities.invokeLater`确保UI更新操作在EDT线程中执行
- 在后台线程中执行耗时的FFmpeg处理，保持UI响应性

这些现代Java特性不仅提高了代码质量和可维护性，还使程序在处理大量视频文件时更加高效和稳定。

## 常见问题解决

1. **VBS脚本无法执行**
   - 确保Windows允许执行脚本
   - 尝试右键点击并选择"以管理员身份运行"

2. **"找不到FFmpeg"错误**
   - 确认FFmpeg已正确安装
   - 确认FFmpeg的bin目录已添加到系统PATH环境变量
   - 重启应用程序以加载更新后的环境变量

3. **处理失败**
   - 查看日志区域获取详细错误信息
   - 确保硬盘有足够的空间
   - 检查输入的参数格式是否正确

## 许可证

本程序仅供学习和个人使用，未经许可不得用于商业目的。

## 联系方式

如有问题或建议，请联系开发者：ocean.quan@wiitrans.com 

## 
### amd 加速
h264_amf

### intel 
h264_qsv

### nv
h264_nvenc